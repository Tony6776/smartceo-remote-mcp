version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
    build:
      commands:
        - mkdir -p .amplify-hosting
        - cp -r . .amplify-hosting/ 2>/dev/null || true
        - cp package*.json .amplify-hosting/ 2>/dev/null || true
        - echo '{"version":1,"framework":"nodejs","routes":[{"path":"/mcp/*","target":"/mcp","type":"rewrite"},{"path":"/*","target":"/","type":"rewrite"}],"deployManifest":{"appRoot":".amplify-hosting","outputPathPrefix":"node_modules"},"compute":{"framework":"NODEJS","startCommand":"node index.js","runtime":"nodejs18"}}' > .amplify-hosting/deploy-manifest.json
  artifacts:
    baseDirectory: .amplify-hosting
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
